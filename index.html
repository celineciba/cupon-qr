<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>C√âLINE ‚Äî Cup√≥n Especial</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="wrap">
    <section class="card" id="card">
      <!-- Banner: usa BANER.jpeg que ya subiste -->
      <img class="banner" src="BANER.jpeg" alt="C√âLINE banner" onerror="this.style.display='none'">

      <div class="brand">
        <div class="brand-top">C√âLINE</div>
        <div class="brand-sub">POP-UP CAF√â BAR ¬∑ C‚Äôest la vie</div>
      </div>

      <h1 class="title">Cup√≥n especial</h1>
      <p class="subtitle">Completa tus datos (15 segundos) y recibe tu cup√≥n al instante.</p>

      <form id="f" novalidate>
        <div class="field">
          <label for="nombre">Nombre y apellido</label>
          <input id="nombre" name="nombre" type="text" placeholder="Ej. Juan P√©rez" required minlength="5" autocomplete="name">
          <small class="hint">Escribe tu nombre real.</small>
        </div>

        <div class="grid2">
          <div class="field">
            <label for="pais">Pa√≠s (WhatsApp)</label>
            <select id="pais" name="pais" required>
              <option value="" selected disabled>Selecciona tu pa√≠s</option>
              <option value="593">Ecuador (+593)</option>
              <option value="1">Estados Unidos (+1)</option>
              <option value="57">Colombia (+57)</option>
              <option value="51">Per√∫ (+51)</option>
              <option value="34">Espa√±a (+34)</option>
              <option value="otro">Otro</option>
            </select>
          </div>

          <div class="field" id="otroWrap" style="display:none;">
            <label for="codPais">C√≥digo pa√≠s</label>
            <input id="codPais" name="codPais" type="text" placeholder="Ej. 44" inputmode="numeric" pattern="^[0-9]{1,4}$">
            <small class="hint">Solo n√∫meros, sin +</small>
          </div>
        </div>

        <div class="field">
          <label for="celular">N√∫mero de WhatsApp</label>
          <input id="celular" name="celular" type="tel" placeholder="Ej. 0991234567" required inputmode="numeric" pattern="^[0-9]{7,15}$" autocomplete="tel">
          <small class="hint">Solo d√≠gitos (sin espacios). Debe ser tu WhatsApp real.</small>
        </div>

        <div class="field">
          <label for="email">Correo electr√≥nico</label>
          <input id="email" name="email" type="email" placeholder="Ej. nombre@email.com" required autocomplete="email">
          <small class="hint">Debe ser un correo real.</small>
        </div>

        <div class="field">
          <label for="red">Red favorita</label>
          <select id="red" name="red" required>
            <option value="" selected disabled>Selecciona una opci√≥n</option>
            <option value="Instagram">Instagram</option>
            <option value="TikTok">TikTok</option>
          </select>
          <small class="hint">Obligatorio.</small>
        </div>

        <div class="field">
          <label for="usuario">Usuario o link (obligatorio)</label>
          <input
            id="usuario"
            name="usuario"
            type="text"
            placeholder="@tuusuario (o link)"
            required
            minlength="2"
            autocomplete="off"
          >
          <small class="hint" id="userHint">
            Debe ser real. Ej: <b>@usuario</b> o un link v√°lido.
          </small>
        </div>

        <button class="btn" type="submit" id="btn">Obtener cup√≥n</button>

        <p class="legal">
          Al enviar aceptas que C√âLINE use estos datos solo para esta promoci√≥n y novedades.
        </p>
      </form>

      <!-- Pantalla de resultado -->
      <div class="result" id="result" style="display:none;">
        <h2 class="ok">Listo ‚úÖ</h2>
        <p class="subtitle2">Tu cup√≥n fue generado:</p>
        <div class="coupon" id="couponBox"></div>

        <p class="subtitle2">Ahora toca aqu√≠ para envi√°rtelo por WhatsApp:</p>
        <a class="btn" id="waBtn" target="_blank" rel="noopener">Recibir por WhatsApp</a>

        <button class="btn ghost" id="backBtn" type="button">Editar datos</button>
      </div>
    </section>

    <footer class="foot">
      <span>¬© C√âLINE</span>
    </footer>
  </main>

<script>
  const f = document.getElementById('f');
  const pais = document.getElementById('pais');
  const otroWrap = document.getElementById('otroWrap');
  const codPais = document.getElementById('codPais');
  const red = document.getElementById('red');
  const usuario = document.getElementById('usuario');

  const result = document.getElementById('result');
  const couponBox = document.getElementById('couponBox');
  const waBtn = document.getElementById('waBtn');
  const backBtn = document.getElementById('backBtn');

  // Mostrar campo "Otro" para c√≥digo de pa√≠s
  pais.addEventListener('change', () => {
    if (pais.value === 'otro') {
      otroWrap.style.display = 'block';
      codPais.setAttribute('required', 'required');
      codPais.focus();
    } else {
      otroWrap.style.display = 'none';
      codPais.removeAttribute('required');
      codPais.value = '';
    }
  });

  // Ajustar hint seg√∫n red
  red.addEventListener('change', () => {
    if (red.value === 'Instagram') {
      usuario.placeholder = '@tuinstagram (o link)';
    } else if (red.value === 'TikTok') {
      usuario.placeholder = '@tutiktok (o link)';
    } else {
      usuario.placeholder = '@tuusuario (o link)';
    }
  });

  // Validaci√≥n b√°sica de usuario/link:
  // - Acepta @usuario (2-30) con letras/n√∫meros/._ 
  // - O acepta link http(s)://...
  function isValidUserOrLink(v){
    const s = (v || '').trim();
    if (!s) return false;
    const isHandle = /^@[a-zA-Z0-9._]{2,30}$/.test(s);
    const isUrl = /^https?:\/\/[^\s]+$/i.test(s);
    return isHandle || isUrl;
  }

  function makeCoupon(){
    // Ej: CELINE-8H2KQ (5 chars)
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let out = '';
    for (let i=0;i<5;i++) out += chars[Math.floor(Math.random()*chars.length)];
    return `CELINE-${out}`;
  }

  function onlyDigits(s){ return (s||'').replace(/\D/g,''); }

  f.addEventListener('submit', (e) => {
    e.preventDefault();

    // Validaci√≥n HTML nativa
    if (!f.checkValidity()) {
      f.reportValidity();
      return;
    }

    // Validaci√≥n usuario/link
    if (!isValidUserOrLink(usuario.value)) {
      usuario.setCustomValidity('Escribe @usuario o un link v√°lido (https://...)');
      f.reportValidity();
      usuario.focus();
      return;
    } else {
      usuario.setCustomValidity('');
    }

    // Pa√≠s/c√≥digo
    let cc = pais.value;
    if (cc === 'otro') cc = onlyDigits(codPais.value);
    if (!cc || !/^[0-9]{1,4}$/.test(cc)) {
      codPais.setCustomValidity('Escribe un c√≥digo pa√≠s v√°lido');
      f.reportValidity();
      codPais.focus();
      return;
    } else {
      codPais.setCustomValidity('');
    }

    const phone = onlyDigits(document.getElementById('celular').value);
    if (!/^[0-9]{7,15}$/.test(phone)) {
      document.getElementById('celular').setCustomValidity('N√∫mero inv√°lido');
      f.reportValidity();
      document.getElementById('celular').focus();
      return;
    } else {
      document.getElementById('celular').setCustomValidity('');
    }

    // Generar cup√≥n
    const coupon = makeCoupon();
    couponBox.textContent = coupon;

    // Mensaje WhatsApp (cliente da 1 clic en enviar)
    const nombre = document.getElementById('nombre').value.trim();
    const redVal = red.value;
    const userVal = usuario.value.trim();
    const email = document.getElementById('email').value.trim();

    const msg =
`Hola ${nombre} üëã
Aqu√≠ est√° tu CUP√ìN ESPECIAL de C√âLINE:

üéüÔ∏è C√≥digo: ${coupon}

‚úÖ Presenta este c√≥digo en caja para validar tu beneficio.
üìå Red: ${redVal}
üìå Usuario/Link: ${userVal}
üìß Email: ${email}

C√âLINE ¬∑ C‚Äôest la vie`;

    const waLink = `https://wa.me/${cc}${phone}?text=${encodeURIComponent(msg)}`;
    waBtn.href = waLink;

    // Mostrar resultado
    f.style.display = 'none';
    result.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  backBtn.addEventListener('click', () => {
    result.style.display = 'none';
    f.style.display = 'block';
  });
</script>
</body>
</html>

